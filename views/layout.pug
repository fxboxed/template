//- views/layout.pug
doctype html
html(lang="en")
  head
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width, initial-scale=1")

    //- ---------- Defaults (override via res.locals in routes) ----------
    - var _title    = (typeof title !== "undefined" && title) ? String(title) : "Site";
    - var _desc     = (typeof description !== "undefined" && description) ? String(description) : "Static Node site";
    - var _canon    = (typeof canonical !== "undefined" && canonical) ? String(canonical) : "";
    - var _siteName = (typeof siteName !== "undefined" && siteName) ? String(siteName) : "Site";
    - var _ogType   = (typeof ogType !== "undefined" && ogType) ? String(ogType) : "website";
    - var _ogImage  = (typeof ogImage !== "undefined" && ogImage) ? String(ogImage) : ((typeof defaultOgImage !== "undefined" && defaultOgImage) ? String(defaultOgImage) : "");
    - var _twCard   = (typeof twitterCard !== "undefined" && twitterCard) ? String(twitterCard) : "summary_large_image";
    - var _twImage  = (typeof twitterImage !== "undefined" && twitterImage) ? String(twitterImage) : (_ogImage || "");
    - var _twSite   = (typeof twitterSite !== "undefined" && twitterSite) ? String(twitterSite) : "";
    - var _twCreator= (typeof twitterCreator !== "undefined" && twitterCreator) ? String(twitterCreator) : "";
    - var _robots   = (typeof robots !== "undefined" && robots) ? String(robots) : "";
    - var _gaId     = (typeof gaId !== "undefined" && gaId) ? String(gaId) : "";

    //- ---------- Core SEO ----------
    title #{_title}
    meta(name="description" content=_desc)
    meta(name="referrer" content="strict-origin-when-cross-origin")
    if _robots
      meta(name="robots" content=_robots)

    if _canon
      link(rel="canonical" href=_canon)

    //- ---------- Open Graph ----------
    meta(property="og:site_name" content=_siteName)
    meta(property="og:title" content=_title)
    meta(property="og:description" content=_desc)
    meta(property="og:type" content=_ogType)
    if _canon
      meta(property="og:url" content=_canon)
    if _ogImage
      meta(property="og:image" content=_ogImage)

    //- ---------- Twitter ----------
    meta(name="twitter:card" content=_twCard)
    meta(name="twitter:title" content=_title)
    meta(name="twitter:description" content=_desc)
    if _twImage
      meta(name="twitter:image" content=_twImage)
    if _canon
      meta(name="twitter:url" content=_canon)
    if _twSite
      meta(name="twitter:site" content=_twSite)
    if _twCreator
      meta(name="twitter:creator" content=_twCreator)

    //- ---------- Google Analytics (Consent Mode stub only) ----------
    //- Do NOT load GA here. Only set default consent to denied.
    if _gaId
      script.
        window.__GA_MEASUREMENT_ID__ = "#{_gaId}";
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent','default',{
          analytics_storage:'denied',
          ad_storage:'denied',
          ad_user_data:'denied',
          ad_personalization:'denied'
        });

    //- Per-page extras
    block head

    link(rel="stylesheet" href="/css/main.css")

  body
    include ./partials/contact-modal.pug

    .burger#burger
      span.bar
      span.bar
      span.bar

    //- ✅ Cookie consent UI included ONCE (not in an overridable block)
    include ./partials/cookie-consent.pug

    //- Optional hook for future cookie-related extras (leave empty for now)
    block cookie

    include ./partials/header.pug

    main.site-main(role="main")
      section.container
        block content

    include ./partials/footer.pug

    //- ✅ Core scripts always loaded (cannot be overridden by child templates)
script(src="/js/aptati-consent.js" defer)

    script(src="/js/nav-toggle.js" defer)
    script(src="/js/contact-modal.js" defer)

    //- Page-specific scripts (child templates can add with "append scripts")
    block scripts
